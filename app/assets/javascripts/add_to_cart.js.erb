jQuery.fn.extend({
  add_to_cart: function () {
    var DEBUG = false;

    // makes sure it picks the item name
    // instead of 'Select Product' in semantic framework
    var itemName   = $('div.selected').text();

    var itemValue  = $('#item_value').val();
    var itemAmount = $('#item_amount').val();
    var itemTotal  = $('#item_total').val();

    if (DEBUG) {
      console.log(itemName);
    }

    if (itemName != '' && itemAmount != '') {
      // avoid duplicated entries on the table
      var duplicated = false;

      $('td').each(function() {
        var text = $(this).text();

        if (DEBUG) {
          console.log(text);
        }

        if (text == itemName) {
          duplicated = true;
        }
      });

      if (!duplicated) {
        $(this).append(
"          <tr>"+
"            <td name='item[name]' name-for="+itemName+">"+itemName+"</td>\n" +
"            <td name='item[value]' value-for="+itemName+">"+itemValue+"</td>\n" +
"            <td name='item[amount]' amount-for="+itemName+">"+itemAmount+"</td>\n" +
"            <td name='item[total]' total-for="+itemName+">"+itemTotal+"</td>\n" +
"          </tr>\n"
        );
      } else {
        var amountColumn  = $('td[amount-for="'+itemName+'"]');
        var totalColumn   = $('td[total-for="'+itemName+'"]');
        var newAmount     = parseInt(amountColumn.text()) + parseInt(itemAmount);

        amountColumn.text(newAmount);
        totalColumn.text((newAmount * parseFloat(itemValue)).toFixed(2));

        if (DEBUG) {
          console.log('found duplicated');
        }
      }
    }

    var cart_total = 0.0;

    $('td[total-for]').each(function() {
      if (DEBUG) {
        console.log(this);
      }

      cart_total += parseFloat($(this).text());
    });

    $('#cart_total').val(cart_total.toFixed(2));
  }
});
